<?xml version="1.0" encoding="utf-8"?>
<odoo>
  <data>
    
    <template id="inherit_report_delivery_document" inherit_id="stock.report_delivery_document">
      <xpath expr="//t[@name='aggregated_move_lines']" position="replace">
        <t t-else="" name="aggregated_move_lines">
          <t t-if="o.company_id.name.lower() == 'masontsika'">
            <t t-set="aggregated_lines" t-value="o.move_line_ids._get_aggregated_product_quantities()"/>
            <t t-call="tanatech_stock.stock_report_delivery_aggregated_move_lines_masontsika"/>
          </t>
          <t t-else="">
            <t t-set="aggregated_lines" t-value="o.move_line_ids._get_aggregated_product_quantities()"/>
            <t t-call="stock.stock_report_delivery_aggregated_move_lines"/>
          </t>
        </t>
      </xpath>
      <xpath expr="//th[@name='th_sml_qty_ordered']" position="replace">
        <t t-if="o.company_id.name.lower() == 'masontsika'">
          <th name="th_sml_qty_ordered" class="text-center" t-if="not has_serial_number">
            <strong>Commandé</strong>
          </th>
        </t>
        <t t-else="">
          <th name="th_sml_qty_ordered" class="text-center" t-if="not has_serial_number">
            <strong>Commandé</strong>
          </th>
        </t>
      </xpath>
      <xpath expr="//th[@name='th_sml_quantity']" position="replace">
        <t t-if="o.company_id.name.lower() == 'masontsika'">
          <th name="th_sml_quantity" class="text-center"><strong>Délivré</strong></th>
        </t>
        <t t-else="">
          <th name="th_sml_quantity" class="text-center"><strong>Délivré</strong></th>
        </t>
      </xpath>
      <xpath expr="//th[@name='th_sm_quantity']" position="after">
        <th name="th_sm_price_unit"><strong>Prix unitaire</strong></th>
      </xpath>
        <xpath expr="//th[@name='th_sml_quantity']" position="after">
          <th name="th_sml_price_unit"><strong>Prix unitaire</strong></th>
        </xpath>
    </template>

    <template id="stock_report_delivery_aggregated_move_lines_masontsika">
      <tr t-foreach="aggregated_lines" t-as="line">
          <td>
              <span t-esc="aggregated_lines[line]['name']"/>
              <p t-if="aggregated_lines[line]['description']">
                  <span t-esc="aggregated_lines[line]['description']"  t-options="{'widget': 'text'}"/>
              </p>
          </td>
          <td class="text-center" name="move_line_aggregated_qty_ordered">
              <span t-esc="aggregated_lines[line]['qty_ordered']"
                  t-options="{'widget': 'float', 'decimal_precision': 'Product Unit of Measure'}"/>
              <span t-esc="aggregated_lines[line]['product_uom']"/>
          </td>
          <td class="text-center" name="move_line_aggregated_qty_done">
              <t t-if="aggregated_lines[line]['qty_done']">
                  <span t-esc="aggregated_lines[line]['qty_done']"
                      t-options="{'widget': 'float', 'decimal_precision': 'Product Unit of Measure'}"/>
                  <span t-esc="aggregated_lines[line]['product_uom']"/>
              </t>
          </td>
          <td class="text-center" name="move_line_aggregated_price_unit">
            <t t-if="aggregated_lines[line]['price_unit']">
              <span t-out="aggregated_lines[line]['price_unit']" t-options="{'widget': 'float', 'precision': 2}" /> 
            </t>
          </td>
      </tr>
    </template>

    <template id="inherit_tanatech_report_delivery_document" inherit_id="tanatech_stock.tanatech_report_delivery_document">
        <xpath expr="//t[@name='aggregated_move_lines']" position="replace">
          <t t-else="" name="aggregated_move_lines">
            <t t-if="o.company_id.name.lower() == 'masontsika'">
              <t t-set="aggregated_lines" t-value="o.move_line_ids._get_aggregated_product_quantities()"/>
              <t t-call="tanatech_stock.stock_report_delivery_aggregated_move_lines_masontsika"/>
            </t>
            <t t-else="">
              <t t-set="aggregated_lines" t-value="o.move_line_ids._get_aggregated_product_quantities()"/>
              <t t-call="stock.stock_report_delivery_aggregated_move_lines"/>
            </t>
          </t>
        </xpath>
        <xpath expr="//th[@name='th_sml_qty_ordered']" position="replace">
          <t t-if="o.company_id.name.lower() == 'masontsika'">
            <th name="th_sml_qty_ordered" class="text-center" t-if="not has_serial_number">
              <strong>Commandé</strong>
            </th>
          </t>
          <t t-else="">
            <th name="th_sml_qty_ordered" class="text-center" t-if="not has_serial_number">
              <strong>Commandé</strong>
            </th>
          </t>
        </xpath>
        <xpath expr="//th[@name='th_sml_quantity']" position="replace">
          <t t-if="o.company_id.name.lower() == 'masontsika'">
            <th name="th_sml_quantity" class="text-center"><strong>Délivré</strong></th>
          </t>
          <t t-else="">
            <th name="th_sml_quantity" class="text-center"><strong>Délivré</strong></th>
          </t>
        </xpath>
    </template>
  
  </data>
</odoo>
